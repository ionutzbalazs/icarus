<!DOCTYPE html>
<html>
    <head>
        <title>Project Icarus</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">

        <style>
        /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        </style>

        <script type="text/javascript" src="/scripts/jquery-3.2.1.min.js"></script>
        <script type="text/javascript" src="/scripts/forecastService.js"></script>
        <script type="text/javascript" src="/scripts/archiveService.js"></script>
        <script type="text/javascript" src="/scripts/locations.js"></script>
    </head>
    <body>
        <div id="map"></div>
        <script type="text/javascript">
         var archive = new ArchiveService('68DoUmZ4rMTTjBuzmx6sGqnLLxVVyTIQ7BGQeOBI');
         var forecast = new ForecastService('II81jq-woKlvAbIi-LyjbTRRay67syxn');
         var locationPins = new LocationService();
            $(document).ready(function() {
               
            });

            var map;

            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 5,
                center: new google.maps.LatLng(40, -97),
                mapTypeId: 'terrain'
                });
            
                map.addListener('click', function(event){
                  createMarkers(locationPoints);                
                });

                function callback(result){
                    console.log(result.lat, result.long, result.dni.annual)
                     var latLng = new google.maps.LatLng(result.lat, result.long);
                var marker = new google.maps.Marker({
                    position: latLng,
                    map: map,
                    icon:getCircle(result.dni.annual),
                    animation: google.maps.Animation.DROP,
             });
            }

            function createMarkers(result){
                for (var i = 0; i < 1; i++) {
                    if (result[i].population > 10000) {
                        archive.get(result[i].latitude, result[i].longitude, callback)
                    }
                }
            }

            function getCircle(kw) {
                return {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: generateColor(kw),
                    fillOpacity: .5,
                    scale: 30,
                    strokeColor: 'white',
                    strokeWeight: .5
                };
            }
        
            function getIcon(radiationValue) {
                var color = generateColor(radiationValue);
                return "http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=" + radiationValue + "|" + color;
            }

        function generateColor(radiationValue) {
            var min = 0.3 //$("#min").text();
            var max = 1.2//$("#max").text();
            var percent = 255 - Math.floor(parseInt((radiationValue - min) * 100) / (max - min)*2.55);
            var  g =  percent.toString(16)  < 16 ?  "00" : percent.toString(16);
            var r = "ff"
            var b = "00";
            return "#" + r + g + b;
        }
}

        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIUEYxLJCHuwGoL7zq-6VDUpg-GpWkpSs&callback=initMap"> </script>        
    </body>
</html>